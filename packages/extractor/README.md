# Extractor

Extract JSON Resume metadata from PDF files generated by `flouka-studio`.

## Features

- ✅ Extracts embedded JSON Resume from PDF attachments
- ✅ Type-safe with TypeScript
- ✅ Works with PDFs generated by flouka-studio
- ✅ Simple async API
- ✅ File path or byte array input

## Usage

### Extract from File Path

```typescript
import { extractResumeFromFile } from "extractor";

const result = await extractResumeFromFile("resume.pdf");

if (result.success) {
  console.log("Name:", result.resume.basics.name);
  console.log("Email:", result.resume.basics.email);
} else {
  console.error("Error:", result.error);
}
```

### Extract from PDF Bytes

```typescript
import { extractResumeFromPDF } from "extractor";

const pdfBytes = await Bun.file("resume.pdf").arrayBuffer();
const result = await extractResumeFromPDF(new Uint8Array(pdfBytes));

if (result.success) {
  // Work with result.resume
}
```

### Check if PDF Has Resume Metadata

```typescript
import { hasResumeMetadata } from "extractor";

const pdfBytes = new Uint8Array(await Bun.file("resume.pdf").arrayBuffer());
const hasMetadata = await hasResumeMetadata(pdfBytes);

if (hasMetadata) {
  console.log("PDF contains embedded resume data");
}
```

## API

### `extractResumeFromPDF(pdfBytes: Uint8Array): Promise<ExtractionResult>`

Extract JSON Resume from PDF bytes.

**Parameters:**
- `pdfBytes` - Uint8Array containing the PDF file

**Returns:** Promise resolving to `ExtractionResult`

### `extractResumeFromFile(filePath: string): Promise<ExtractionResult>`

Extract JSON Resume from a PDF file path.

**Parameters:**
- `filePath` - Path to the PDF file

**Returns:** Promise resolving to `ExtractionResult`

### `hasResumeMetadata(pdfBytes: Uint8Array): Promise<boolean>`

Check if a PDF contains resume metadata without extracting it.

**Parameters:**
- `pdfBytes` - Uint8Array containing the PDF file

**Returns:** Promise resolving to boolean

## ExtractionResult

```typescript
interface ExtractionResult {
  success: boolean;
  resume?: ResumeSchema;  // Only present if success is true
  error?: string;          // Only present if success is false
}
```

## Example

```bash
bun run example.ts
```

This will extract the resume from `../../resumes/example_output.pdf` and save it to `../../resumes/extracted_resume.json`.

## Requirements

The PDF must be generated by `flouka-studio` which embeds the original JSON Resume as a file attachment named `resume.json`.

## How it Works

1. Loads the PDF using pdf-lib
2. Looks for the Names dictionary in the PDF catalog
3. Searches for EmbeddedFiles
4. Finds the `resume.json` attachment
5. Extracts the stream contents (handles FlateDecode compression automatically)
6. Parses the JSON content
7. Returns the ResumeSchema object

**Note:** The extractor automatically handles compressed streams (FlateDecode filter), which is how pdf-lib saves embedded files by default.

## Integration

This package works seamlessly with:
- **xebec-render**: Generate HTML from extracted resume
- **flouka-studio**: Original PDF generator
- **validator**: Validate extracted resume data

